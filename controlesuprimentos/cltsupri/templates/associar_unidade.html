{% extends 'index.html' %}

{% block content %}
<div class="container mt-5">

  <!-- Mensagens de sucesso ou erro -->
  {% if messages %}
    {% for message in messages %}
      <div class="alert alert-{{ message.tags }}">{{ message }}</div>
    {% endfor %}
  {% endif %}

  <h5 class="mb-4">
    {% if editando %} Editando Associação {% else %} Associar Unidade a Prefixo do Nome da Máquina {% endif %}
  </h5>

  <form method="post" class="mb-4">
    {% csrf_token %}

    {% if form.non_field_errors %}
      <div class="alert alert-danger">{{ form.non_field_errors }}</div>
    {% endif %}

    <div class="row">
      <div class="col-md-6 mb-3">
        {{ form.prefixo_nome.label_tag }}
        {{ form.prefixo_nome }}
        {% for error in form.prefixo_nome.errors %}
          <div class="text-danger small">{{ error }}</div>
        {% endfor %}
      </div>

      <div class="col-md-6 mb-3">
        {{ form.unidade.label_tag }}
        {{ form.unidade }}
        {% for error in form.unidade.errors %}
          <div class="text-danger small">{{ error }}</div>
        {% endfor %}
      </div>
    </div>

    <div class="mt-3">
      <button type="submit" class="btn btn-primary">
        {% if editando %} Salvar Alterações {% else %} Salvar Associação {% endif %}
      </button>

      {% if editando %}
        <a href="{% url 'associar_unidade' %}" class="btn btn-secondary ms-2">Cancelar</a>
      {% endif %}
    </div>
  </form>

  <hr>

  <h5>Associações Existentes</h5>
  <table class="table table-striped table-hover w-75">
    <thead>
      <tr>
        <th>Prefixo Nome</th>
        <th>Unidade</th>
        <th>Projeto</th>
        <th class="text-center">Ações</th>
      </tr>
    </thead>
    <tbody>
      {% for assoc in associacoes %}
      <tr>
        <td>{{ assoc.prefixo_nome }}</td>
        <td>{{ assoc.unidade.nome }}</td>
        <td>{{ assoc.unidade.projeto.nome }}</td>
        <td class="text-center">
          <a href="{% url 'associar-unidade-action' assoc.id 'edit' %}" class="btn btn-sm btn-warning">Editar</a>
          <a href="{% url 'associar-unidade-action' assoc.id 'delete' %}" class="btn btn-sm btn-danger"
             onclick="return confirm('Deseja realmente excluir esta associação?');">Excluir</a>
        </td>
      </tr>
      {% empty %}
      <tr><td colspan="4" class="text-center text-muted">Nenhuma associação cadastrada.</td></tr>
      {% endfor %}
    </tbody>
  </table>
</div>
{% endblock %}
