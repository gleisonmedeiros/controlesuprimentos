{% extends 'index.html' %}

{% block content %}
<div class="container mt-5">

  <!-- Mensagens de sucesso ou erro -->
  {% if messages %}
    {% for message in messages %}
      <div class="alert alert-{{ message.tags }}">{{ message }}</div>
    {% endfor %}
  {% endif %}

  <h5 class="mb-4">
    {% if editando %} Editando Associa√ß√£o {% else %} Associar Unidade a Prefixo do Nome da M√°quina {% endif %}
  </h5>

  <form method="post" class="mb-4">
    {% csrf_token %}

    {% if form.non_field_errors %}
      <div class="alert alert-danger">{{ form.non_field_errors }}</div>
    {% endif %}

    <div class="row">
      <div class="col-md-6 mb-3">
        {{ form.prefixo_nome.label_tag }}
        {{ form.prefixo_nome }}
        {% for error in form.prefixo_nome.errors %}
          <div class="text-danger small">{{ error }}</div>
        {% endfor %}
      </div>

      <div class="col-md-6 mb-3">
        {{ form.unidade.label_tag }}
        {{ form.unidade }}
        {% for error in form.unidade.errors %}
          <div class="text-danger small">{{ error }}</div>
        {% endfor %}
      </div>
    </div>

    <div class="mt-3">
      <button type="submit" class="btn btn-primary">
        {% if editando %} Salvar Altera√ß√µes {% else %} Salvar Associa√ß√£o {% endif %}
      </button>

      {% if editando %}
        <a href="{% url 'associar_unidade' %}" class="btn btn-secondary ms-2">Cancelar</a>
      {% endif %}
    </div>
  </form>

  <hr>

  <h5>Associa√ß√µes Existentes</h5>
  <table class="table table-striped table-hover w-75">
    <thead>
      <tr>
        <th>Prefixo Nome</th>
        <th>Unidade</th>
        <th>Projeto</th>
        <th class="text-center">A√ß√µes</th>
      </tr>
    </thead>
    <tbody>
      {% for assoc in associacoes %}
      <tr>
        <td>{{ assoc.prefixo_nome }}</td>
        <td>{{ assoc.unidade.nome }}</td>
        <td>{{ assoc.unidade.projeto.nome }}</td>
        <td class="text-center">
          <a href="{% url 'associar-unidade-action' assoc.id 'edit' %}" class="btn btn-sm btn-warning">Editar</a>
          <a href="{% url 'associar-unidade-action' assoc.id 'delete' %}" class="btn btn-sm btn-danger"
             onclick="return confirm('Deseja realmente excluir esta associa√ß√£o?');">Excluir</a>
        </td>
      </tr>
      {% empty %}
      <tr><td colspan="4" class="text-center text-muted">Nenhuma associa√ß√£o cadastrada.</td></tr>
      {% endfor %}
    </tbody>
  </table>
</div>

<!-- ====== üîΩ ADI√á√ÉO DO SELECT2 üîΩ ====== -->
<!-- CSS do Select2 -->
<link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />

<!-- jQuery + JS do Select2 -->
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>

<script>
$(document).ready(function() {
  $('#id_unidade').select2({
    placeholder: "Selecione ou pesquise uma unidade...",
    allowClear: true,
    width: '100%',
    language: {
      noResults: function() {
        return "Nenhum resultado encontrado";
      }
    }
  });
});
</script>

<!-- Estilo para combinar com Bootstrap -->
<style>
.select2-container .select2-selection--single {
  height: 38px !important;
  border: 1px solid #ced4da !important;
  border-radius: 0.375rem !important;
}
.select2-selection__rendered {
  line-height: 36px !important;
}
</style>

{% endblock %}
