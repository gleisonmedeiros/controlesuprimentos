{% extends 'index.html' %}

{% block content %}
<h4>Cadastro de Equipamento</h4>

<form method="POST" id="form-cadastro-equipamento" class="mb-4">
  {% csrf_token %}

  <div class="row">
    <!-- Projeto -->
    <div class="col-md-6 mb-3">
      <label for="id_projeto">Projeto</label>
      <select name="projeto" id="id_projeto" class="form-control">
        <option value="">Selecione um Projeto</option>
        {% for projeto in projetos %}
          <option value="{{ projeto.id }}" {% if projeto.id|stringformat:"s" == selected_projeto %}selected{% endif %}>{{ projeto.nome }}</option>
        {% endfor %}
      </select>
    </div>

    <!-- Unidade -->
    <div class="col-md-6 mb-3">
      <label for="id_unidade">Unidade</label>
      <select name="unidade" id="id_unidade" class="form-control">
        <option value="">Selecione uma Unidade</option>
        {% for unidade in unidades %}
          <option value="{{ unidade.id }}" {% if unidade.id|stringformat:"s" == selected_unidade %}selected{% endif %}>{{ unidade.nome }}</option>
        {% endfor %}
      </select>
    </div>
  </div>

  <div class="row">
    <!-- Patrimônio -->
    <div class="col-md-6 mb-3">
      <label for="id_patrimonio">Patrimônio</label>
      <input type="text" name="patrimonio" id="id_patrimonio" class="form-control" value="{{ form.patrimonio.value|default_if_none:'' }}">
    </div>

    <!-- Marca -->
    <div class="col-md-6 mb-3">
      <label for="id_marca">Marca</label>
      <input type="text" name="marca" id="id_marca" class="form-control" value="{{ form.marca.value|default_if_none:'' }}">
    </div>
  </div>

  <div class="row">
    <!-- Modelo -->
    <div class="col-md-6 mb-3">
      <label for="id_modelo">Modelo</label>
      <input type="text" name="modelo" id="id_modelo" class="form-control" value="{{ form.modelo.value|default_if_none:'' }}">
    </div>

    <!-- Nome -->
    <div class="col-md-6 mb-3">
      <label for="id_nome">Nome</label>
      <select name="nome" id="id_nome" class="form-control">
        <option value="">Selecione o Nome</option>
        {% for chave, valor in tipos %}
          <option value="{{ chave }}" {% if form.nome.value == chave %}selected{% endif %}>{{ valor }}</option>
        {% endfor %}
      </select>
    </div>
  </div>

  <div class="row">
    <!-- Tipo (opcional) -->
    <div class="col-md-6 mb-3">
      <label for="id_tipo">Tipo (opcional)</label>
      <input type="text" name="tipo" id="id_tipo" class="form-control" value="{{ form.tipo.value|default_if_none:'' }}">
    </div>
    <div class="col-md-6 mb-3"></div> <!-- Espaço vazio para alinhar -->
  </div>

  <button type="submit" class="btn btn-primary">Cadastrar Equipamento</button>
</form>

<!-- Listagem dos equipamentos continua igual -->
<h4>Equipamentos cadastrados</h4>
<table class="table table-striped">
  <thead class="table-dark">
    <tr>
      <th>Projeto</th>
      <th>Unidade</th>
      <th>Nome</th>
      <th>Patrimônio</th>
      <th>Marca</th>
      <th>Modelo</th>
      <th>Tipo</th>
    </tr>
  </thead>
  <tbody>
    {% for equipamento in equipamentos %}
      <tr>
        <td>{{ equipamento.unidade.projeto.nome }}</td>
        <td>{{ equipamento.unidade.nome }}</td>
        <td>{{ equipamento.get_nome_display }}</td>
        <td>{{ equipamento.patrimonio }}</td>
        <td>{{ equipamento.marca }}</td>
        <td>{{ equipamento.modelo }}</td>
        <td>{{ equipamento.tipo }}</td>
      </tr>
    {% empty %}
      <tr><td colspan="7">Nenhum equipamento cadastrado.</td></tr>
    {% endfor %}
  </tbody>
</table>

<script>
  // Atualiza o formulário para mostrar unidades filtradas quando o projeto muda
  document.getElementById('id_projeto').addEventListener('change', function() {
    this.form.submit();
  });
</script>

{% endblock %}
