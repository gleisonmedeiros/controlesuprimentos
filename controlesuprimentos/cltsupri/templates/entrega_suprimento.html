<!-- entrega_suprimento.html -->
{% extends 'index.html' %}

{% block content %}



<div class="container mt-5">
        <h2 class="mb-4 text-center">Cadastro de Usuário</h2>
        <div class="text-end mb-2">
            <button id="addRow" class="btn btn-primary">+</button>
        </div>
        <div class="table-responsive">
            <table id="dataGrid" class="table table-striped table-bordered rounded-3 overflow-hidden">
                <thead class="table-dark">
                    <tr>
                        <th>Toner</th>
                        <th>Quantidade</th>
                        <th>Setor</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><input type="text" class="form-control toner-input" placeholder="Toner" list="tonerList" ></td>
                        <td><input type="number" class="form-control" placeholder="Quantidade"></td>
                        <td><input type="text" class="form-control" placeholder="Setor"></td>
                    </tr>
                </tbody>
            </table>
            <datalist id="tonerList">
                {% for suprimento in form.fields.suprimento.queryset %}
                    <option value="{{ suprimento.nome }}">
                {% endfor %}
            </datalist>

        </div>
        <div class="text-center mt-4">
            <button class="btn btn-success btn-lg">Salvar</button>
        </div>
    </div>

<script>
    $(document).ready(function() {
        console.log("jQuery carregado!");

        if ($.fn.DataTable) {
            console.log("DataTables carregado!");
        } else {
            console.error("DataTables NÃO foi carregado corretamente!");
        }

        const table = $('#dataGrid').DataTable({
            "language": {
                "url": "https://cdn.datatables.net/plug-ins/1.13.6/i18n/pt-BR.json"
            },
            "info": false,
            "lengthChange": false,
            "paging": false,
            "searching": false
        });

        $('#addRow').on('click', function() {
            console.log("Botão clicado!");
            table.row.add([
                '<input type="text" class="form-control toner-input" placeholder="Toner" list="tonerList">',
                '<input type="number" class="form-control" placeholder="Quantidade">',
                '<input type="text" class="form-control" placeholder="Setor">'
            ]).draw();
        });
    });
</script>


<div class="container mt-5">
    <h2 class="text-center">Cadastro de Entrega de Suprimento</h2>

    {% for error in errors %}
        {% if error == '0' %}
            <div id="mensagem-alerta" class="alert alert-success" role="alert">
                Unidade salva com Sucesso
            </div>
    {% endif %}
    {% endfor %}

    <form method="POST" >
        {% csrf_token %}

        <div class="form-group">
        <label for="form_projeto">Projeto</label>
        <select name="form_projeto" id="mycombo" class="form-control">
            <option value="">Selecione um Projeto</option>
            {% for projeto in form_projeto %}
                <option value="{{ projeto.id }}">{{ projeto.nome }}</option>
            {% endfor %}
        </select>
        </div>

        <div class="text-center mt-3">
            <input name="save_projeto" type="submit" class="btn btn-primary" value="Selecionar"></input>
        </div>
        </form>

    <form method="POST" id="secondForm">
        {% csrf_token %}

            <div class="form-group">
                <label for="{{ form.unidade.id_for_label }}">Unidade</label>
                {{ form.unidade }}
            </div>

            <div class="form-group">
                <label for="{{ form.suprimento.id_for_label }}">Suprimento</label>
                {{ form.suprimento }}
            </div>

            <div class="form-group">
                <label for="{{ form.quantidade_entregue.id_for_label }}">Quantidade Entregue</label>
                {{ form.quantidade_entregue }}
            </div>

            <div class="form-group">
                <label for="{{ form.data.id_for_label }}">Data</label>
                {{ form.data }}
            </div>

            <div class="form-group">
                <label for="{{ form.setor.id_for_label }}">Setor</label>
                {{ form.setor }}
            </div>

            <div class="text-center mt-3">
                <input name="save_entrega" type="submit" class="btn btn-primary" value="Salvar"></input>
            </div>

    </form>
</div>
{% for error in errors %}
        {% if error == '0' %}
            <div id="mensagem-alerta" class="alert alert-success" role="alert">
                Unidade salva com Sucesso
            </div>
        {% else %}
            <!-- <div id="mensagem-alerta" class="alert alert-danger" role="alert">
                {{ error }}
            </div>-->
        {% endif %}
    {% endfor %}
{% endblock %}

<script>
    document.getElementById('mycombo').addEventListener('change', function () {
        const selectedValue = this.value;

        if (selectedValue) {
            // Enviar valor selecionado via fetch para a view
            fetch('/processar-selecao/', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'X-CSRFToken': '{{ csrf_token }}'  // Django precisa do token CSRF
                },
                body: JSON.stringify({ selected: selectedValue })
            })
            .then(response => response.json())
            .then(data => {
                // Exibir a resposta do servidor
                document.getElementById('result').innerHTML = `Você selecionou o projeto com ID: ${data.result}`;
            })
            .catch(error => console.error('Erro:', error));
        } else {
            // Exibir mensagem quando nada for selecionado
            document.getElementById('result').innerHTML = 'Por favor, selecione um projeto.';
        }
    });
</script>






